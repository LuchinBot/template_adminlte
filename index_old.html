<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Tabs Dinámicos con Páginas</title>
		<!-- Google Fonts -->
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet" />
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
		<link rel="stylesheet" href="src/css/styles.css" />
		<link rel="stylesheet" href="src/css/aside.css" />
		<link rel="stylesheet" href="src/css/content.css" />
		<link rel="stylesheet" href="src/css/ul.css" />
		<link href="src/fontawesome/css/fontawesome.min.css?v=<?=rand();?>" rel="stylesheet" />
		<link href="src/fontawesome/css/all.min.css?v=<?=rand();?>" rel="stylesheet" />
		<link href="src/fontawesome/css/solid.min.css?v=<?=rand();?>" rel="stylesheet" />
		<link href="src/fontawesome/css/brands.min.css?v=<?=rand();?>" rel="stylesheet" />
	</head>
	<body>
		<main class="main-container">
			<div class="fixed-lateral">
				<div class="brand d-flex align-items-center justify-content-center">
					<a href="#" class="brand-title">AdminLTE</a>
				</div>
				<aside class="aside p-0">
					<div class="user-panel">
						<div class="pull-left image">
							<img src="https://adminlte.io/themes/v3/dist/img/user2-160x160.jpg"
								alt="User Image"
								class="img-circle"
							/>
						</div>
						<div class="pull-left info">
							<p>Alexander Pierce</p>
							<a href="#"><i class="fa fa-circle" style="color: rgb(60, 118, 61)"></i> Online</a>
						</div>
					</div>
					<form action="#" method="get" class="sidebar-form">
						<div class="input-group">
							<input type="text" name="q" placeholder="Search..." class="form-control" />
							<span class="input-group-btn"
								><button type="submit" name="search" id="search-btn" class="btn btn-flat"><i class="fa fa-search"></i></button
							></span>
						</div>
					</form>
					<ul class="sidebar-menu" id="menu-links">
						<li class="header">MAIN NAVIGATION</li>
						<li class="treeview">
							<a href="#" class="father toggle-collapse d-flex align-items-center p-3" data-bs-toggle="collapse" aria-expanded="true">
								<i class="fa fa-dashboard"></i> <span>Dashboard</span>
								<span class="pull-right-container"><i class="fa fa-angle-left pull-right"></i></span>
							</a>
							<ul class="treeview-menu collapse">
								<li class="">
									<a href="#" data-tab-url="/dashboard/v2" data-tab-id="tab_4" data-tab-title="Dashboard v2"><i class="far fa-circle"></i> Dashboard v2</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/examples/infobox" data-tab-id="tab_5" data-tab-title="InfoBox"><i class="far fa-circle"></i> InfoBox</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/examples/chart" data-tab-id="tab_6" data-tab-title="Chart.js"><i class="far fa-circle"></i> Chart.js</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/examples/alert" data-tab-id="tab_7" data-tab-title="Alert"><i class="far fa-circle"></i> Alert</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/examples/modal" data-tab-id="tab_8" data-tab-title="Modal"><i class="far fa-circle"></i> Modal</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/examples/api-example" data-tab-id="tab_9" data-tab-title="APIExample"><i class="far fa-circle"></i> APIExample</a>
								</li>
							</ul>
						</li>
						<li class="treeview">
							<a href="#" class="father toggle-collapse d-flex align-items-center p-3" data-bs-toggle="collapse" aria-expanded="true">
								<i class="fa fa-file"></i> <span>Layout Options</span>
								<span class="pull-right-container"><small class="label pull-right label-primary">4</small></span>
							</a>
							<ul class="treeview-menu collapse">
								<li>
									<a href="#" data-tab-url="/layout/top-navigation" data-tab-id="tab_10" data-tab-title="Top Navigation"><i class="far fa-circle"></i> Top Navigation</a>
								</li>
								<li>
									<a href="#" data-tab-url="/layout/boxed" data-tab-id="tab_11" data-tab-title="Boxed"><i class="far fa-circle"></i> Boxed</a>
								</li>
								<li>
									<a href="#" data-tab-url="/layout/fixed" data-tab-id="tab_12" data-tab-title="Fixed"><i class="far fa-circle"></i> Fixed</a>
								</li>
								<li>
									<a href="#" data-tab-url="/layout/collapsed-sidebar" data-tab-id="tab_13" data-tab-title="Collapsed Sidebar"><i class="far fa-circle"></i> Collapsed Sidebar</a>
								</li>
							</ul>
						</li>
						<li class="">
							<a href="#" data-tab-url="/examples/widgets" data-tab-id="tab_14" data-tab-title="Widgets">
								<i class="fa fa-th"></i> <span>Widgets</span>
								<span class="pull-right-container"><small class="label pull-right bg-green">new</small></span>
							</a>
						</li>
						<li class="treeview">
							<a href="#" class="father toggle-collapse d-flex align-items-center p-3" data-bs-toggle="collapse" aria-expanded="true">
								<i class="fa fa-laptop"></i> <span>UI Elements</span>
								<span class="pull-right-container"><i class="fa fa-angle-left pull-right"></i></span>
							</a>
							<ul class="treeview-menu collapse">
								<li class="active">
									<a href="#" data-tab-url="/ui-elements/general" data-tab-id="tab_15" data-tab-title="General"><i class="far fa-circle"></i> General</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/ui-elements/icons" data-tab-id="tab_16" data-tab-title="Icons"><i class="far fa-circle"></i> Icons</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/ui-elements/buttons" data-tab-id="tab_17" data-tab-title="Buttons"><i class="far fa-circle"></i> Buttons</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/ui-elements/sliders" data-tab-id="tab_18" data-tab-title="Sliders"><i class="far fa-circle"></i> Sliders</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/ui-elements/timeline" data-tab-id="tab_19" data-tab-title="Timeline"><i class="far fa-circle"></i> Timeline</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/ui-elements/modals" data-tab-id="tab_20" data-tab-title="Modals"><i class="far fa-circle"></i> Modals</a>
								</li>
							</ul>
						</li>
						<li class="treeview">
							<a href="#" class="father toggle-collapse d-flex align-items-center p-3" data-bs-toggle="collapse" aria-expanded="true">
								<i class="fa fa-edit"></i> <span>Forms</span>
								<span class="pull-right-container"><i class="fa fa-angle-left pull-right"></i></span>
							</a>
							<ul class="treeview-menu collapse">
								<li class="">
									<a href="#" data-tab-url="/forms/general-elements" data-tab-id="tab_21" data-tab-title="General Elements"><i class="far fa-circle"></i> General Elements</a>
								</li>
								<li class="">
									<a href="#" data-tab-url="/forms/advanced-elements" data-tab-id="tab_22" data-tab-title="Advanced Elements"><i class="far fa-circle"></i> Advanced Elements</a>
								</li>
								<li>
									<a href="#" data-tab-url="/forms/editors" data-tab-id="tab_23" data-tab-title="Editors"><i class="far fa-circle"></i> Editors</a>
								</li>
							</ul>
						</li>
					</ul>
				</aside>
			</div>

			<div class="content">
				<div class="top">
					<div class="d-flex w-100 p-3 align-items-center justify-content-between">
						<div class="col-md-3">
							<span class="material-symbols-outlined me-3 menu">menu</span>
						</div>
						<div class="col-md-3 d-flex align-items-center justify-content-end">
							<span class="material-symbols-outlined me-3">account_circle</span>
							<span>Hola, <b>Pericote</b></span>
						</div>
					</div>
				</div>
				<div class="wrapper">
					<div class="tab-container">
						<div class="tab-navigation">
							<button class="btn btn-danger rounded-0 h-100" id="prev-tab">
								<span class="material-symbols-outlined"> keyboard_double_arrow_left </span>
							</button>
							<ul class="nav nav-tabs tab-nav border" id="dynamic-tabs">
								<!-- Aquí aparecen los tabs uwu -->
							</ul>
							<button class="btn btn-danger rounded-0 h-100" id="next-tab">
								<span class="material-symbols-outlined"> keyboard_double_arrow_right </span>
							</button>
						</div>

						<div class="tab-content p-3" id="dynamic-tabs-content">
							<!-- Aquí va el contenido uwu-->
						</div>
					</div>
				</div>
			</div>
		</main>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			// Código js
			document.addEventListener('DOMContentLoaded', function () {
				const tabsContainer = document.querySelector('#dynamic-tabs')
				const tabsContentContainer = document.querySelector('#dynamic-tabs-content')
				const prevButton = document.getElementById('prev-tab')
				const nextButton = document.getElementById('next-tab')
				const menuIcon = document.querySelector('.menu')
				const fixedLateral = document.querySelector('.fixed-lateral')
				const content = document.querySelector('.content')
				const li = document.querySelectorAll('.treeview')

				let currentTabIndex = 0

				// Delegación de eventos para manejar clics en el menú
				document.querySelector('#menu-links').addEventListener('click', async function (e) {
					const target = e.target.closest('a[data-tab-id]')
					console.log(target)
					if (target) {
						e.preventDefault()
						const tabId = target.dataset.tabId
						const tabTitle = target.dataset.tabTitle
						const tabUrl = target.dataset.tabUrl

						if (!document.querySelector(`#tab-${tabId}`)) {
							const newTab = document.createElement('li')
							newTab.className = 'nav-item'
							newTab.innerHTML = `
                    <button class="nav-link text-dark rounded-0" id="tab-${tabId}" data-bs-toggle="tab" data-bs-target="#content-${tabId}" type="button" role="tab">
                        ${tabTitle}
                        <span class="close-tab text-danger">&times;</span>
                    </button>
                `
							tabsContainer.appendChild(newTab)

							const newTabContent = document.createElement('div')
							newTabContent.className = 'tab-pane fade'
							newTabContent.id = `content-${tabId}`
							newTabContent.role = 'tabpanel'
							tabsContentContainer.appendChild(newTabContent)

							try {
								const response = await fetch(tabUrl)
								if (!response.ok) throw new Error('Error al cargar el contenido.')
								newTabContent.innerHTML = await response.text()
							} catch (error) {
								newTabContent.innerHTML = `<p class="text-danger">No se pudo cargar la página: ${error.message}</p>`
							}
						}

						activateTabById(tabId)
					}
				})

				// Manejar cierre de pestañas
				tabsContainer.addEventListener('click', function (e) {
					if (e.target.classList.contains('close-tab')) {
						const tabButton = e.target.parentElement
						const tabId = tabButton.id.replace('tab-', '')
						const contentId = `content-${tabId}`

						tabButton.parentElement.remove()
						document.querySelector(`#${contentId}`).remove()

						const firstTab = tabsContainer.querySelector('.nav-link')
						if (firstTab) firstTab.click()
					}
				})

				// Activar pestaña por índice
				const activateTabByIndex = (index) => {
					const tabs = tabsContainer.querySelectorAll('.nav-link')
					if (index < 0 || index >= tabs.length) return

					currentTabIndex = index
					tabs[currentTabIndex].click()
				}

				// Activar pestaña por ID
				const activateTabById = (id) => {
					const tab = document.querySelector(`#tab-${id}`)
					if (tab) {
						tab.click()
						currentTabIndex = Array.from(tabsContainer.children).indexOf(tab.parentElement)
					}
				}

				// Navegación entre pestañas
				prevButton.addEventListener('click', () => activateTabByIndex(currentTabIndex - 1))
				nextButton.addEventListener('click', () => activateTabByIndex(currentTabIndex + 1))

				// Inicializar primera pestaña si es necesario
				if (tabsContainer.querySelector('.nav-link')) {
					activateTabByIndex(0)
				}

				// Manejo del menú lateral
				if (menuIcon && fixedLateral && content) {
					menuIcon.addEventListener('click', function () {
						fixedLateral.classList.toggle('closed')
						content.classList.toggle('shifted')
					})
				}

				// Manejo de colapsables
				document.querySelectorAll('.treeview > a').forEach((link) => {
					link.addEventListener('click', function (e) {
						e.preventDefault()
						const parentLi = this.closest('li')
						const submenu = parentLi.querySelector('.treeview-menu')
						const icon = this.querySelector('.fa-angle-left')

						if (submenu) {
							submenu.classList.toggle('show')
							icon.style.transform = submenu.classList.contains('show') ? 'rotate(-90deg)' : 'rotate(0deg)'
						}
					})
				})

				// Manejo de elementos activos en el menú
				document.querySelectorAll('.sidebar-menu li').forEach((link) => {
					link.addEventListener('click', function () {
						document.querySelectorAll('.sidebar-menu li').forEach((el) => el.classList.remove('active'))
						this.classList.add('active')
					})
				})
			})
		</script>
	</body>
</html>
